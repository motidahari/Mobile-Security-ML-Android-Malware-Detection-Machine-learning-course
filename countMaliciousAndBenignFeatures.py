import json
from setting import config
from utils import export_to_json, exportToTextFile, sort_by_malicious


def count_malicious_and_benign():
    json_file = config['apksResultJsonPath']
    resultPath = '{path}/Features/countMaliciousAndBenignFeatures-Output.txt'.format(
        path=config['resultApksPath'])
    with open(json_file, "r") as f:
        data = json.load(f)
    arr = []
    result = {}
    for app in data:
        for key, value in app.items():
            if key == "label":
                continue
            if key not in result:
                result[key] = {"malicious": 0, "benign": 0}
            if app["label"] == 1:
                result[key]["malicious"] += 1
            else:
                result[key]["benign"] += 1

    orderLst = sort_by_malicious(result)
    export_to_json(orderLst, resultPath)
    return result


count_malicious_and_benign()
