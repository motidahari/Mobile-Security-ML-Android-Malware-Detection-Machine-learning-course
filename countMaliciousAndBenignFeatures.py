import json
from setting import config


def exportToTextFile(lst, text_file_path) -> bool:
    # open the text file in write mode
    with open(text_file_path, 'w') as f:
        # iterate through the feature list and write each feature to a new line in the text file
        for val in lst:
            f.write(val + '\n')
    print(f'Successfully exported lst to {text_file_path}')
    return True


def sort_by_malicious(result):
    return {k: v for k, v in sorted(result.items(), key=lambda item: item[1]['malicious'], reverse=True)}


def export_to_json(result, file_name):
    result_json = json.dumps(result, indent=4)
    with open(file_name, 'w') as f:
        f.write(result_json)
    print(f'Successfully exported to {file_name}')


def count_malicious_and_benign():
    json_file = config['apksResultJsonPath']
    resultPath = '{path}/countMaliciousAndBenignFeatures-Output.txt'.format(
        path=config['resultApksPath'])
    with open(json_file, "r") as f:
        data = json.load(f)
    arr = []
    result = {}
    for app in data:
        for key, value in app.items():
            if key == "label":
                continue
            if key not in result:
                result[key] = {"malicious": 0, "benign": 0}
            if app["label"] == 1:
                result[key]["malicious"] += 1
            else:
                result[key]["benign"] += 1

    orderLst = sort_by_malicious(result)
    export_to_json(orderLst, resultPath)
    return result


count_malicious_and_benign()
